<div class="header">
    <h1>🧬 GeneticGrid 看盘</h1>
    <div class="controls">
        <select id="symbol-select" v-model="currentSymbol" @change="refreshData(true)">
            <option value="BTC-USDT">BTC/USDT</option>
            <option value="ETH-USDT">ETH/USDT</option>
            <option value="SOL-USDT">SOL/USDT</option>
            <option value="XRP-USDT">XRP/USDT</option>
            <option value="DOGE-USDT">DOGE/USDT</option>
            <option value="ADA-USDT">ADA/USDT</option>
            <option value="AVAX-USDT">AVAX/USDT</option>
            <option value="LINK-USDT">LINK/USDT</option>
        </select>
        <div class="timeframe-buttons">
            <button :class="{ active: currentBar === '1m' }" @click="setBar('1m')">1分</button>
            <button :class="{ active: currentBar === '5m' }" @click="setBar('5m')">5分</button>
            <button :class="{ active: currentBar === '15m' }" @click="setBar('15m')">15分</button>
            <button :class="{ active: currentBar === '1H' }" @click="setBar('1H')">1时</button>
            <button :class="{ active: currentBar === '4H' }" @click="setBar('4H')">4时</button>
            <button :class="{ active: currentBar === '1D' }" @click="setBar('1D')">日线</button>
            <select id="more-timeframes" class="timeframe-select" v-model="moreTimeframe" @change="handleMoreTimeframes">
                <option value="">更多周期...</option>
                <option value="tick">分时</option>
                <option value="1s">1秒</option>
                <option value="5s">5秒</option>
                <option value="15s">15秒</option>
                <option value="30s">30秒</option>
                <option value="1m">1分</option>
                <option value="3m">3分</option>
                <option value="5m">5分</option>
                <option value="15m">15分</option>
                <option value="30m">30分</option>
                <option value="1H">1时</option>
                <option value="3H">3时</option>
                <option value="6H">6时</option>
                <option value="12H">12时</option>
                <option value="1D">1日</option>
                <option value="3D">3日</option>
                <option value="5D">5日</option>
                <option value="1W">1周</option>
                <option value="1M">1月</option>
                <option value="3M">3月</option>
                <option value="custom">自定义...</option>
            </select>
            <input type="text" id="custom-interval" class="custom-interval-input" 
                   v-model="customInterval" 
                   v-show="showCustomInterval"
                   @keypress.enter="applyCustomInterval"
                   placeholder="如: 2H, 7D">
        </div>
        
        <div class="dropdown">
            <button>指标 ▼</button>
            <div class="dropdown-content">
                <div class="dropdown-group">
                    <div class="dropdown-group-title">主图指标 (叠加)</div>
                    <div class="dropdown-item" v-for="(config, key) in mainIndicatorsConfig" :key="key">
                        <label>
                            <input type="checkbox" v-model="indicators[key].enabled" @change="toggleMainIndicator(key)"> 
                            [[ config.label ]]
                        </label>
                        <span class="info-icon" :title="config.title">?</span>
                    </div>
                </div>
                
                <div class="dropdown-group">
                    <div class="dropdown-group-title">副图指标 (单选)</div>
                    <div class="dropdown-item" v-for="(config, key) in subIndicatorsConfig" :key="key">
                        <label>
                            <input type="radio" name="sub-ind" :value="key" v-model="indicators.activeSubIndicator" @change="switchSubIndicator(key)"> 
                            [[ config.label ]]
                        </label>
                        <span class="info-icon" :title="config.title" v-if="config.title">?</span>
                    </div>
                </div>

                <div class="dropdown-group">
                    <div class="dropdown-group-title">其他</div>
                    <div class="dropdown-item">
                        <label><input type="checkbox" v-model="indicators.vol.enabled" @change="toggleMainIndicator('vol')"> VOL (成交量)</label>
                        <span class="info-icon" title="Volume: 交易量。">?</span>
                    </div>
                </div>
            </div>
        </div>

        <span class="source-label">数据源:</span>
        <select id="source-select" class="source-select" v-model="currentSource" @change="refreshData(true)">
            <option value="tradingview">TradingView</option>
            <option value="binance">Binance</option>
            <option value="coingecko">CoinGecko</option>
            <option value="okx">OKX</option>
        </select>
        <div class="refresh-group">
            <button id="refresh-btn" title="手动刷新" @click="refreshData(false)">🔄</button>
            <button id="auto-refresh-btn" :class="{ active: isAutoRefresh }" @click="toggleAutoRefresh" title="切换自动刷新">自动: [[ isAutoRefresh ? '开' : '关' ]]</button>
        </div>
        <button id="settings-btn" title="设置" @click="toggleSettings">⚙️</button>
    </div>
</div>